<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>XP11 Mobile MCP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <style>
        body { background: #0f172a; touch-action: none; -webkit-user-select: none; }
        .active-green { background-color: #22c55e !important; box-shadow: 0 0 15px #22c55e; }
        .active-blue { background-color: #3b82f6 !important; }
        .slider-v { -webkit-appearance: slider-vertical; width: 40px; height: 180px; background: #1e293b; }
    </style>
</head>
<body class="text-slate-200">
    <div class="pt-10 pb-4 px-4 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
        <span class="text-orange-500 font-bold tracking-tighter">XP11 PRO</span>
        <div id="status" class="text-[10px] px-2 py-1 rounded bg-red-900/50 text-red-400">DISCONNECTED</div>
    </div>

    <div class="grid grid-cols-4 gap-2 p-3 bg-slate-900 border-b border-slate-800">
        <div class="flex flex-col items-center">
            <span id="label-ap" class="text-[9px] mb-1 text-slate-500">AP OFF</span>
            <button id="btn-ap" onclick="cmd('AP')" class="w-full bg-slate-800 py-3 rounded text-[10px] font-bold">MASTER</button>
        </div>
        <div class="flex flex-col items-center">
            <span id="val-hdg" class="text-[10px] mb-1 text-orange-400 font-mono">000</span>
            <button ontouchstart="startAdj('hdg', 1)" ontouchend="stopAdj()" class="w-full bg-slate-800 py-3 rounded text-[10px]">HDG</button>
        </div>
        <div class="flex flex-col items-center">
            <span id="val-alt" class="text-[10px] mb-1 text-orange-400 font-mono">05000</span>
            <button ontouchstart="startAdj('alt', 100)" ontouchend="stopAdj()" class="w-full bg-slate-800 py-3 rounded text-[10px]">ALT</button>
        </div>
        <div class="flex flex-col items-center">
            <span id="val-spd" class="text-[10px] mb-1 text-orange-400 font-mono">250</span>
            <button ontouchstart="startAdj('spd', 1)" ontouchend="stopAdj()" class="w-full bg-slate-800 py-3 rounded text-[10px]">SPD</button>
        </div>
    </div>

    <div class="flex justify-between items-center p-6 mt-2">
        <div id="joy-zone" class="w-44 h-44 bg-slate-800/50 rounded-full border-2 border-slate-700"></div>
        <div class="flex flex-col items-center">
            <input type="range" class="slider-v" min="0" max="1" step="0.01" value="0" oninput="send('THR', this.value)">
            <span class="text-[10px] mt-2 text-slate-500 font-bold">THRUST</span>
        </div>
    </div>

    <div class="mx-4 p-3 bg-black/40 rounded-xl border border-slate-800 grid grid-cols-3 gap-4">
        <div class="text-center">
            <div class="text-[9px] text-slate-500 mb-1">GEAR</div>
            <div class="flex justify-center gap-1">
                <div id="gear-l" class="w-2 h-4 bg-slate-700 rounded-sm"></div>
                <div id="gear-n" class="w-2 h-4 bg-slate-700 rounded-sm"></div>
                <div id="gear-r" class="w-2 h-4 bg-slate-700 rounded-sm"></div>
            </div>
        </div>
        <div class="text-center border-x border-slate-800 px-2">
            <div class="text-[9px] text-slate-500 mb-1">FLAPS</div>
            <div id="val-flaps" class="text-xs text-green-500 font-mono">UP</div>
        </div>
        <div class="text-center">
            <div class="text-[9px] text-slate-500 mb-1">TRIM</div>
            <div class="h-4 w-full bg-slate-800 rounded relative">
                <div id="trim-bar" class="absolute left-1/2 w-1 h-full bg-orange-500 transition-all"></div>
            </div>
        </div>
    </div>

    <script>
        // 配置：请修改为你 Radmin LAN 的电脑 IP
        const PC_IP = "26.x.x.x"; 
        const ws = new WebSocket(`ws://${PC_IP}:8080`);
        let state = { ap: false, hdg: 0, alt: 5000, spd: 250 };
        let adjInterval = null;

        ws.onopen = () => {
            const st = document.getElementById('status');
            st.innerText = "CONNECTED";
            st.className = "text-[10px] px-2 py-1 rounded bg-green-900/50 text-green-400";
        };

        function send(type, val) {
            if(ws.readyState === 1) ws.send(JSON.stringify({type, val}));
        }

        // AP 切换逻辑
        function cmd(type) {
            if(type === 'AP') {
                state.ap = !state.ap;
                document.getElementById('btn-ap').classList.toggle('active-green');
                document.getElementById('label-ap').innerText = state.ap ? "AP ENGAGED" : "AP OFF";
                document.getElementById('label-ap').classList.toggle('text-green-400');
                send('AP_MASTER', state.ap);
            }
            if(navigator.vibrate) navigator.vibrate(10);
        }

        // 数值长按调节
        function startAdj(type, step) {
            const adjust = () => {
                if(type === 'hdg') state.hdg = (state.hdg + step) % 360;
                if(type === 'alt') state.alt += step;
                if(type === 'spd') state.spd += step;
                document.getElementById(`val-${type}`).innerText = state[type].toString().padStart(type==='alt'?5:3, '0');
                send('SET_VALUE', {type, value: state[type]});
                if(navigator.vibrate) navigator.vibrate(5);
            };
            adjust();
            adjInterval = setInterval(adjust, 150);
        }
        function stopAdj() { clearInterval(adjInterval); }

        // 摇杆初始化
        const manager = nipplejs.create({ zone: document.getElementById('joy-zone'), mode: 'static', position: {left: '50%', top: '50%'}, color: '#3b82f6' });
        manager.on('move', (e, d) => send('AXIS', {x: d.vector.x, y: d.vector.y}));
        manager.on('end', () => send('AXIS', {x: 0, y: 0}));
    </script>
</body>
</html>
